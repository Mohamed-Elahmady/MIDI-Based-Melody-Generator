"""
test_play_arrays.py
Play melody and duration arrays to test correctness.
"""

import numpy as np
import simpleaudio as sa
import time
import math

# C-style arrays (example)
melody = [60, 65, 65, 60, 65, 65, 64, 65, 67, 69, 65, 69, 70, 72, 69, 67, 65,
          69, 67, 69, 65, 64, 67, 65, 60, 65, 65, 60, 65, 65, 64, 65, 67, 69,
          65, 69, 70, 72, 69, 67, 65, 69, 67, 69, 65, 64, 67, 65, 69, 69, 69,
          67, 65, 70, 69, 67, 67, 70, 70, 70, 69, 67, 72, 70, 69, 69, 69, 69,
          69, 67, 65, 70, 69, 67, 67, 69, 70, 72, 72, 72, 72, 69, 67, 65, 69,
          67, 69, 65, 64, 67, 65, 60, 65, 65, 60, 65, 65, 64, 65, 67, 69, 65,
          69, 70, 72, 69, 67, 65, 69, 67, 69, 65, 64, 67, 65]
duration = [162,  656, 373, 146, 658,  219, 192,  154, 1178, 329,  643,  329, 238,
            720,  462, 162, 400, 228,  351, 319,  779, 492,  127,  1035, 138, 686,
            372,  124, 656, 246, 181,  152, 1192, 348, 637,  303,  230,  734, 441,
            152,  368, 187, 368, 227,  640, 440,  131, 766,  305,  103,  728, 275,
            225,  755, 472, 73,  2025, 419, 77,   771, 286,  244,  758,  559, 85,
            2089, 244, 106, 682, 351,  271, 725,  562, 77,   1138, 214,  124, 666,
            316,  92,  729, 437, 135,  360, 297,  352, 313,  771,  403,  122, 1052,
            151,  675, 368, 166, 624,  209, 187,  186, 1173, 311,  620,  325, 287,
            775,  448, 133, 410, 232,  329, 224,  732, 392,  100]

SAMPLE_RATE = 44100

def play_note(midi_note, dur):
    frequency = 440.0 * (2.0 ** ((midi_note - 69) / 12.0))
    t = np.linspace(0, dur, int(SAMPLE_RATE * dur), False)
    wave = np.sin(frequency * t * 2 * math.pi)
    audio = (wave * 32767).astype(np.int16)

    play_obj = sa.play_buffer(audio, 1, 2, SAMPLE_RATE)
    play_obj.wait_done()

# Play melody
for i in range(len(melody)):
    play_note(melody[i], duration[i])
    time.sleep(0.05)